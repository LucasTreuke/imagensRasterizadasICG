<!DOCTYPE html>
<html>
<head>
	<title> Processamento de imagens em Canvas </title>
	<script type="text/javascript" async
		src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async>
	</script>
</head>
<body>
	<h1>Aplicação de filtros</h1>
	<div id="buttons"></div>
<figure>
	<canvas id="imagemOriginal" width="900" height="600"></canvas>
	<canvas id="imagemOutputN" width="900" height="600"></canvas>
<figcaption>
		Primeira imagem: Original, segunda: Processada.
	</figcaption>
</figure>

<script>
	var canvasOriginal = document.getElementById("imagemOriginal");
	var ctxOriginal = canvasOriginal.getContext("2d");
	

	var canvasOutN = document.getElementById("imagemOutputN");
	var ctxOutputN = canvasOutN.getContext("2d");
	
	var imgOriginal = new Image();
	var imgDataOut = new Image();
	
	
	var imgUrl = "https://fotografiamais.com.br/wp-content/uploads/2018/08/foto-preto-e-branco-fotografia-preto-e-branco-tecnicas.jpg";
	// var imgUrl = "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c8/Eiffel_tower_at_Exposition_Universelle%2C_Paris%2C_1889.jpg/800px-Eiffel_tower_at_Exposition_Universelle%2C_Paris%2C_1889.jpg";

	imgOriginal.crossOrigin = '';
	imgDataOut.crossOrigin = '';
    imgOriginal.src = imgUrl;


	kernel_list = {
		"sharpen": [0, -1, 0, -1, 5, -1, 0, -1, 0],
		"edges": [-1,-1,-1,-1,8,-1,-1,-1,-1],
		"gaussian_blur": [1/16, 2/16, 1/16, 2/16, 4/16, 2/16, 1/16, 2/16, 1/16],
		"blur": [1/9, 1/9, 1/9, 1/9, 1/9, 1/9, 1/9, 1/9, 1/9],
		"id": [0,0,0,0,1,0,0,0,0]
	}
	
	function apply_filter(filter_to_apply){	
		canvasOriginal.width = imgOriginal.width
		canvasOriginal.height = imgOriginal.height
		canvasOutN.width = imgOriginal.width
		canvasOutN.height = imgOriginal.height
		
		ctxOriginal.drawImage(imgOriginal, 0, 0);
		
		imgDataOut = ctxOriginal.getImageData(0, 0, imgOriginal.width, imgOriginal.height);
		imgOg = ctxOriginal.getImageData(0, 0, imgOriginal.width, imgOriginal.height).data;

		for (let i = 0; i < imgDataOut.data.length; i += 4) {
		
			pixel_color = apply_kernel(imgOg, i, imgOriginal.width, imgDataOut.data.length, filter_to_apply)
			imgDataOut.data[i] = pixel_color
			imgDataOut.data[i+1] = pixel_color
			imgDataOut.data[i+2] = pixel_color
		
		}
		
		ctxOutputN.putImageData(imgDataOut, 0, 0);
	}


	function apply_kernel(img,i,width,data_legth, filter){
		isBorder = false
		pixel = img[i]
		
		if( i%(width*4)==0){ //inicio de linha
			isBorder = true
		}else if(  (i+4) % (width*4)  ==0){ //fim de linha
			isBorder = true
		}else if(i - width*4 <0){
			isBorder = true
		}else if(i + width*4 > data_legth){
			isBorder = true
		}
		if (isBorder){
			pixel = 0
		}
		else{
			pixel = img[i]*filter[4]

			pixel+=filter[0]*img[i-(4*width)]
			pixel+=filter[1]*img[i-4-(4*width)]
			pixel+=filter[2]*img[i+4-(4*width)]
			pixel+=filter[3]*img[i-4]
			pixel+=filter[5]*img[i+4]
			pixel+=filter[6]*img[i+(4*width)]
			pixel+=filter[7]*img[i-4+(4*width)]
			pixel+=filter[8]*img[i+4+(4*width)]
		}

		return pixel
	}

	imgOriginal.onload = apply_filter(kernel_list.id)

	buttons_container = document.getElementById("buttons")
	for(i in kernel_list){
		button = document.createElement("button")
		button.innerText = i
		button.onclick = function(e){apply_filter(kernel_list[e.target.innerText])}
		buttons_container.appendChild(button)
	}
</script>

</body>
</html>